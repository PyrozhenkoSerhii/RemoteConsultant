{"version":3,"sources":["../../server/controllers/consultation.js"],"names":["router","express","Router","get","req","res","Consultation","find","query","populate","consultations","status","send","data","isObjectId","findById","params","id","consultation","error","post","body","validationError","validateSync","errors","save","saved","put","patch","messages","push","message","delete","remove","process","env","NODE_ENV","deleteMany","length","module","exports"],"mappings":"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","sourcesContent":["import express from 'express'\r\nimport _merge from 'lodash/assignIn'\r\nimport _last from 'lodash/last'\r\n\r\nimport Consultation from '../models/Consultation'\r\nimport wrap from '../middlewares/wrap'\r\nimport { isObjectId } from '../middlewares/validators'\r\n\r\nconst router = express.Router()\r\n\r\n\r\nrouter.get('/consultation/list/', wrap(async (req, res) => {\r\n    const consultations = await Consultation.find(req.query).populate('consultant')\r\n\r\n    res.status(200).send({ data: consultations })\r\n}))\r\n\r\n\r\nrouter.get('/consultation/list/:id', isObjectId, wrap(async (req, res) => {\r\n    const consultation = await Consultation.findById(req.params.id)\r\n    if (!consultation) return res.status(400).send({ error: `Consultation Not Found` })\r\n    res.status(200).send({ data: consultation })\r\n}))\r\n\r\n\r\nrouter.post('/consultation/', wrap(async (req, res) => {\r\n    let consultation = new Consultation({ ...req.body })\r\n\r\n    const validationError = consultation.validateSync()\r\n    if (validationError) return res.status(400).send({ error: validationError.errors })\r\n\r\n    const saved = await consultation.save()\r\n    res.status(201).send({ data: saved })\r\n}))\r\n\r\n\r\nrouter.put('/consultation/list/:id', isObjectId, wrap(async (req, res) => {\r\n    const consultation = await Consultation.findById(req.params.id)\r\n    if (!consultation) return res.status(400).send({ error: `Consultation Not Found` })\r\n\r\n    _merge(consultation, req.body)\r\n\r\n    const validationError = consultation.validateSync()\r\n    if (validationError) return res.status(400).send({ error: validationError.errors })\r\n\r\n    const saved = await consultation.save()\r\n    res.status(200).send({ data: saved })\r\n}))\r\n\r\n\r\n/**\r\n * Request body must be like:\r\n * @param {object} message Message object you want to insert\r\n */\r\nrouter.patch('/consultation/list/:id/message', isObjectId, wrap(async (req, res) => {\r\n    const consultation = await Consultation.findById(req.params.id)\r\n    if (!consultation) return res.status(400).send({ error: `Consultation Not Found` })\r\n\r\n    consultation.messages.push(req.body.message)\r\n\r\n    const validationError = _last(consultation.messages).validateSync()\r\n    if (validationError) return res.status(400).send({ error: validationError.errors })\r\n\r\n    const saved = await consultation.save()\r\n    res.status(200).send({ data: saved })\r\n}))\r\n\r\n\r\nrouter.delete('/consultation/list/:id', isObjectId, wrap(async (req, res) => {\r\n    const consultation = await Consultation.findById(req.params.id)\r\n    if (!consultation) return res.status(400).send({ error: `Consultation Not Found` })\r\n\r\n    await consultation.remove()\r\n    res.status(200).send({ message: `Consultation deleted` })\r\n}))\r\n\r\n\r\n/**\r\n * Adding an opportunity to clear a collection for non-production environment\r\n */\r\nprocess.env.NODE_ENV !== 'prod' && router.delete('/consultation/clear', wrap(async (req, res) => {\r\n    await Consultation.deleteMany()\r\n\r\n    const consultations = await Consultation.find()\r\n    if (consultations.length) return res.status(500).send({ error: `Due to unknown reason consultations weren't deleted` })\r\n\r\n    res.status(200).send({ message: 'Consultations were deleted' })\r\n}))\r\n\r\n\r\nmodule.exports = router"],"file":"consultation.js"}