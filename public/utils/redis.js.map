{"version":3,"sources":["../../server/utils/redis.js"],"names":["client","redis","createClient","port","config","host","retry_strategy","options","error","code","Error","total_retry_time","attempt","undefined","Math","min","on","logger","info","err"],"mappings":";;;;;;;AAAA;;AAEA;;AACA;;;;AAEA,IAAMA,MAAM,GAAGC,eAAMC,YAAN,CAAmB;AAC9BC,EAAAA,IAAI,EAAEC,gBAAOH,KAAP,CAAaE,IADW;AAE9BE,EAAAA,IAAI,EAAED,gBAAOH,KAAP,CAAaI,IAFW;AAG9BC,EAAAA,cAAc,EAAE,wBAACC,OAAD,EAAa;AACzB,QAAIA,OAAO,CAACC,KAAR,IAAiBD,OAAO,CAACC,KAAR,CAAcC,IAAd,KAAuB,cAA5C,EAA4D;AACxD,aAAO,IAAIC,KAAJ,CAAU,mCAAV,CAAP;AACH;;AACD,QAAIH,OAAO,CAACI,gBAAR,GAA2B,OAAO,EAAP,GAAY,EAA3C,EAA+C;AAC3C,aAAO,IAAID,KAAJ,CAAU,sBAAV,CAAP;AACH;;AACD,QAAIH,OAAO,CAACK,OAAR,GAAkB,EAAtB,EAA0B;AACtB,aAAOC,SAAP;AACH;;AACD,WAAOC,IAAI,CAACC,GAAL,CAASR,OAAO,CAACK,OAAR,GAAkB,GAA3B,EAAgC,IAAhC,CAAP;AACH;AAd6B,CAAnB,CAAf;;AAiBAZ,MAAM,CAACgB,EAAP,CAAU,SAAV,EAAqB,YAAM;AACvBC,kBAAOC,IAAP,8CAAkDd,gBAAOH,KAAP,CAAaE,IAA/D,uBAAgFC,gBAAOH,KAAP,CAAaI,IAA7F;AACH,CAFD;AAIAL,MAAM,CAACgB,EAAP,CAAU,OAAV,EAAmB,UAACG,GAAD,EAAS;AACxBF,kBAAOT,KAAP,wBAA6BW,GAA7B;AACH,CAFD;eAIenB,M","sourcesContent":["import redis from 'redis'\r\n\r\nimport config from '../config'\r\nimport logger from './logger'\r\n\r\nconst client = redis.createClient({\r\n    port: config.redis.port,\r\n    host: config.redis.host,\r\n    retry_strategy: (options) => {\r\n        if (options.error && options.error.code === 'ECONNREFUSED') {\r\n            return new Error('The server refused the connection');\r\n        }\r\n        if (options.total_retry_time > 1000 * 60 * 60) {\r\n            return new Error('Retry time exhausted');\r\n        }\r\n        if (options.attempt > 10) {\r\n            return undefined;\r\n        }\r\n        return Math.min(options.attempt * 100, 3000);\r\n    }\r\n})\r\n\r\nclient.on('connect', () => {\r\n    logger.info(`[Redis] Connection created on port ${config.redis.port} and host ${config.redis.host}`)\r\n})\r\n\r\nclient.on('error', (err) => {\r\n    logger.error(`Redis error: ${err} `)\r\n})\r\n\r\nexport default client\r\n"],"file":"redis.js"}